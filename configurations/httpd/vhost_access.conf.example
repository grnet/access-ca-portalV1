<VirtualHost *:80>
  RailsEnv production
  ServerName YOUR_SERVER_NAME_HERE
  # !!! Be sure to point DocumentRoot to 'public'!
  # In case of HTTPS redirection of traffic, this should be commented out.
  #DocumentRoot /var/www/access-ca-portal/public

  # Redirect HTTP traffic to HTTPS
  RewriteEngine on
  RewriteCond %{HTTPS} !=on
  RewriteRule ^(.*) https://%{SERVER_NAME}/$1 [R,L]
  <Directory /var/www/access-ca-portal/public>
     Options -Indexes
     # This relaxes Apache security settings.
     AllowOverride all
     # MultiViews must be turned off.
     Options -MultiViews
  </Directory>
</VirtualHost>

<VirtualHost *:443>
  RailsEnv production
  ServerName YOUR_SERVER_NAME_HERE
  DocumentRoot /var/www/access-ca-portal/public

  SSLEngine on
  SSLCipherSuite ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4
  SSLCertificateFile PATH_TO_YOUR_CERTIFICATE_FILE
  SSLCertificateKeyFile PATH_TO_YOUR_CERT_KEY_FILE
  SSLCACertificatePath PATH_TO_YOUR_CA_CERTIFICATES
  SSLInsecureRenegotiation on

  BrowserMatch ".*MSIE.*" \
           nokeepalive ssl-unclean-shutdown \
           downgrade-1.0 force-response-1.0
  AddOutputFilterByType DEFLATE text/html text/plain text/xml application/xml application/xhtml+xml text/javascript text/css
  BrowserMatch ^Mozilla/4 gzip-only-text/html
  BrowserMatch ^Mozilla/4.0[678] no-gzip
  BrowserMatch bMSIE !no-gzip !gzip-only-text/html

  <Directory "/var/www/access-ca-portal/public">
    Allow from all
    AllowOverride all
    Options -MultiViews
  </Directory>

  <Location "/el/account">
    SSLVerifyClient optional
    SSLVerifyDepth 5
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate +LegacyDNStringFormat
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>
  <Location "/el/host">
    SSLVerifyClient require
    SSLVerifyDepth 5
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate +LegacyDNStringFormat
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>
  <Location "/el/ra">
    SSLVerifyClient require
    SSLVerifyDepth 5
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate +LegacyDNStringFormat
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>
<Location "/el/ca">
    SSLVerifyClient require
    SSLVerifyDepth 5
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate +LegacyDNStringFormat
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>
  <Location "/comatose_admin">
    SSLVerifyClient require
    SSLVerifyDepth 5
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate +LegacyDNStringFormat
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>
  <Location "/el/myproxy">
    SSLVerifyClient require
    SSLVerifyDepth 5
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate +LegacyDNStringFormat
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>
  <Location "/el/support">
    SSLVerifyClient require
    SSLVerifyDepth 5
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>
  <Location "/el/cert/test_browser_for_user_cert/">
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate +LegacyDNStringFormat
    SSLVerifyClient optional
    SSLVerifyDepth 5
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>
  <Location "/en/account">
    SSLVerifyClient optional
    SSLVerifyDepth 5
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate +LegacyDNStringFormat
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>
  <Location "/en/host">
    SSLVerifyClient require
    SSLVerifyDepth 5
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate +LegacyDNStringFormat
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>
  <Location "/en/ra">
    SSLVerifyClient require
    SSLVerifyDepth 5
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate +LegacyDNStringFormat
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>
  <Location "/en/ca">
    SSLVerifyClient require
    SSLVerifyDepth 5
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate +LegacyDNStringFormat
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>
  <Location "/en/myproxy">
    SSLVerifyClient require
    SSLVerifyDepth 5
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate +LegacyDNStringFormat
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>
  <Location "/en/support">
    SSLVerifyClient require
    SSLVerifyDepth 5
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate +LegacyDNStringFormat
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>
  <Location "/en/cert/test_browser_for_user_cert/">
    SSLOptions +StdEnvVars +ExportCertData +OptRenegotiate +LegacyDNStringFormat
    SSLVerifyClient optional
    SSLVerifyDepth 5
    RequestHeader add REDIRECT_SSL_CLIENT_S_DN %{SSL_CLIENT_S_DN}e
  </Location>

</VirtualHost>
